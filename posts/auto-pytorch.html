<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-02-25">

<title>AutoML PyTorch – Nipun Batra Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c3c2c9e745155556954bc4da23476b10.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-c3c2c9e745155556954bc4da23476b10.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c3c2c9e745155556954bc4da23476b10.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6f4daa0acb84b33b6cf00c2f0c443f78.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-f1f85bb7dbd4314d5ad09add27c1e8f0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-6f4daa0acb84b33b6cf00c2f0c443f78.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Nipun Batra Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io"> 
<span class="menu-text">Homepage</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">AutoML PyTorch</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">ML</div>
                <div class="quarto-category">automl</div>
                <div class="quarto-category">neural-architecture-search</div>
                <div class="quarto-category">hyperparameter-optimization</div>
                <div class="quarto-category">automated-machine-learning</div>
                <div class="quarto-category">pytorch</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nipun Batra </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 25, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#inputs-to-meta-learning-model" id="toc-inputs-to-meta-learning-model" class="nav-link active" data-scroll-target="#inputs-to-meta-learning-model">Inputs to Meta Learning model</a>
  <ul class="collapse">
  <li><a href="#data-inputs" id="toc-data-inputs" class="nav-link" data-scroll-target="#data-inputs">Data inputs</a></li>
  <li><a href="#encoder-inputs" id="toc-encoder-inputs" class="nav-link" data-scroll-target="#encoder-inputs">Encoder inputs</a></li>
  </ul></li>
  <li><a href="#encoder-internals" id="toc-encoder-internals" class="nav-link" data-scroll-target="#encoder-internals">### Encoder internals</a></li>
  <li><a href="#encoder-outputs" id="toc-encoder-outputs" class="nav-link" data-scroll-target="#encoder-outputs">### Encoder outputs</a></li>
  <li><a href="#decoder-inputs" id="toc-decoder-inputs" class="nav-link" data-scroll-target="#decoder-inputs">### Decoder inputs</a></li>
  <li><a href="#decoder-outputs" id="toc-decoder-outputs" class="nav-link" data-scroll-target="#decoder-outputs">### Decoder outputs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p>—author: Nipun Batrabadges: truecategories:- ML- automl- neural-architecture-search- hyperparameter-optimization- automated-machine-learning- pytorchdate: ’2023-02-25’output-file: auto-pytorch.htmltitle: AutoML PyTorchtoc: true—</p>
<p>In this post, we look at AutoPyTorch, a framework for automated machine learning.</p>
<div id="61b5dd25" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile <span class="im">as</span> tmp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.datasets</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'JOBLIB_TEMP_FOLDER'</span>] <span class="op">=</span> tmp.gettempdir()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'OMP_NUM_THREADS'</span>] <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'OPENBLAS_NUM_THREADS'</span>] <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'MKL_NUM_THREADS'</span>] <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5063082a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autoPyTorch.api.tabular_regression <span class="im">import</span> TabularRegressionTask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ef5d9eea" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> sklearn.datasets.load_diabetes(return_X_y<span class="op">=</span><span class="va">True</span>, as_frame<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> sklearn.model_selection.train_test_split(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    X,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    y,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain training and validation data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>X_train, X_valid, y_train, y_valid <span class="op">=</span> sklearn.model_selection.train_test_split(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    X_train,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    y_train,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="79432f5f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X_train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">bmi</th>
<th data-quarto-table-cell-role="th">bp</th>
<th data-quarto-table-cell-role="th">s1</th>
<th data-quarto-table-cell-role="th">s2</th>
<th data-quarto-table-cell-role="th">s3</th>
<th data-quarto-table-cell-role="th">s4</th>
<th data-quarto-table-cell-role="th">s5</th>
<th data-quarto-table-cell-role="th">s6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>-0.052738</td>
<td>-0.044642</td>
<td>-0.009439</td>
<td>-0.005671</td>
<td>0.039710</td>
<td>0.044719</td>
<td>0.026550</td>
<td>-0.002592</td>
<td>-0.018118</td>
<td>-0.013504</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">121</td>
<td>0.063504</td>
<td>-0.044642</td>
<td>0.017506</td>
<td>0.021872</td>
<td>0.008063</td>
<td>0.021546</td>
<td>-0.036038</td>
<td>0.034309</td>
<td>0.019908</td>
<td>0.011349</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>0.023546</td>
<td>0.050680</td>
<td>-0.020218</td>
<td>-0.036656</td>
<td>-0.013953</td>
<td>-0.015092</td>
<td>0.059685</td>
<td>-0.039493</td>
<td>-0.096433</td>
<td>-0.017646</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">287</td>
<td>0.045341</td>
<td>-0.044642</td>
<td>-0.006206</td>
<td>-0.015999</td>
<td>0.125019</td>
<td>0.125198</td>
<td>0.019187</td>
<td>0.034309</td>
<td>0.032433</td>
<td>-0.005220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">397</td>
<td>0.052606</td>
<td>-0.044642</td>
<td>-0.004050</td>
<td>-0.030918</td>
<td>-0.046975</td>
<td>-0.058307</td>
<td>-0.013948</td>
<td>-0.025840</td>
<td>0.036056</td>
<td>0.023775</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="1768946e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>y_train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>52      59.0
121    173.0
170     47.0
287    219.0
397    198.0
Name: target, dtype: float64</code></pre>
</div>
</div>
<div id="fac3da0a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf.predict(X_test)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(y_test, y_pred_rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>62.77500577100372</code></pre>
</div>
</div>
<div id="394a8518" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pred_df <span class="op">=</span> pd.DataFrame({<span class="st">"rf"</span>: y_pred_rf, <span class="st">"true"</span>: y_test})</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pred_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rf</th>
<th data-quarto-table-cell-role="th">true</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">246</td>
<td>140.76</td>
<td>78.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">425</td>
<td>109.89</td>
<td>152.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">293</td>
<td>161.93</td>
<td>200.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>70.81</td>
<td>59.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>150.91</td>
<td>311.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="670facf8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use validation dataset to find best hyperparameters for RF</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> {<span class="st">"n_estimators"</span>: [<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>], <span class="st">"max_depth"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>]}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(rf, hyperparameters, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">"neg_root_mean_squared_error"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_valid, y_valid)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>grid_search.best_params_</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>{'max_depth': 5, 'n_estimators': 100}</code></pre>
</div>
</div>
<div id="ac630448" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the RF model using the best hyperparameters on train + validation data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(<span class="op">**</span>grid_search.best_params_, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine train and validation data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>X_train_overall <span class="op">=</span> pd.concat([X_train, X_valid])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y_train_overall <span class="op">=</span> pd.concat([y_train, y_valid])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train_overall, y_train_overall)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf.predict(X_test)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(y_test, y_pred_rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>61.69476644955032</code></pre>
</div>
</div>
<div id="27a178f2" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> TabularRegressionTask()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Do an api search without any memory limit but use only MLPs</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>api.search(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    X_train<span class="op">=</span>X_train_overall,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    y_train<span class="op">=</span>y_train_overall,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    X_test<span class="op">=</span>X_test.copy(),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    y_test<span class="op">=</span>y_test.copy(),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    optimize_metric<span class="op">=</span><span class="st">'r2'</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    total_walltime_limit<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    func_eval_time_limit_secs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    dataset_name<span class="op">=</span><span class="st">"Diabetes"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    memory_limit<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    enable_traditional_pipeline<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;autoPyTorch.api.tabular_regression.TabularRegressionTask at 0x1945be6d0&gt;</code></pre>
</div>
</div>
<div id="beaea446" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> api.predict(X_test)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> api.score(y_pred, y_test)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(score)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'r2': 0.3026643977627368}</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>60.33987680300709</code></pre>
</div>
</div>
<div id="3a5a8e31" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print statistics from search</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(api.sprint_statistics())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>autoPyTorch results:
    Dataset name: Diabetes
    Optimisation Metric: r2
    Best validation score: 0.4352600925944532
    Number of target algorithm runs: 13
    Number of successful target algorithm runs: 10
    Number of crashed target algorithm runs: 2
    Number of target algorithms that exceeded the time limit: 1
    Number of target algorithms that exceeded the memory limit: 0
</code></pre>
</div>
</div>
<div id="de8ffab7" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>api.get_models_with_weights()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(0.62,
 MyTraditionalTabularRegressionPipeline(config='random_forest',
                                        dataset_properties={'categorical_columns': [],
                                                            'categories': [],
                                                            'input_shape': (10,),
                                                            'is_small_preprocess': True,
                                                            'issigned': True,
                                                            'issparse': False,
                                                            'numerical_columns': [0,
                                                                                  1,
                                                                                  2,
                                                                                  3,
                                                                                  4,
                                                                                  5,
                                                                                  6,
                                                                                  7,
                                                                                  8,
                                                                                  9],
                                                            'output_shape': 1,
                                                            'output_type': 'continuous',
                                                            'target_type': 'tabular_regression',
                                                            'task_type': 'tabular_regression'},
                                        init_params={'instance': None},
                                        random_state=RandomState(MT19937) at 0x194150240))</code></pre>
</div>
</div>
<div id="13455e7f" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>api.get_models_with_weights()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(0.18,
 ________________________________________
    TabularRegressionPipeline
 ________________________________________
 0-) imputer: 
    SimpleImputer
 
 1-) variance_threshold: 
    VarianceThreshold
 
 2-) coalescer: 
    NoCoalescer
 
 3-) encoder: 
    NoEncoder
 
 4-) scaler: 
    StandardScaler
 
 5-) feature_preprocessor: 
    NoFeaturePreprocessor
 
 6-) tabular_transformer: 
    TabularColumnTransformer
 
 7-) preprocessing: 
    EarlyPreprocessing
 
 8-) network_embedding: 
    autoPyTorch.pipeline NoEmbedding
 
 9-) network_backbone: 
    autoPyTorch.pipeline ShapedMLPBackbone
 
 10-) network_head: 
    autoPyTorch.pipeline FullyConnectedHead
 
 11-) network: 
    Sequential ({'random_state': RandomState(MT19937) at 0x19465E140, '_fit_requirements': [FitRequirement(name='network_head', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False), FitRequirement(name='network_backbone', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False), FitRequirement(name='network_embedding', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False)], '_cs_updates': {}, 'device': device(type='cpu'), 'network': Sequential(
   (0): _NoEmbedding()
   (1): Sequential(
     (0): Linear(in_features=10, out_features=200, bias=True)
     (1): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (2): ReLU()
     (3): Linear(in_features=200, out_features=200, bias=True)
     (4): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (5): ReLU()
     (6): Linear(in_features=200, out_features=200, bias=True)
     (7): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (8): ReLU()
     (9): Linear(in_features=200, out_features=200, bias=True)
     (10): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (11): ReLU()
     (12): Linear(in_features=200, out_features=200, bias=True)
   )
   (2): Sequential(
     (0): Flatten(start_dim=1, end_dim=-1)
     (1): Linear(in_features=200, out_features=128, bias=True)
     (2): ReLU()
     (3): Linear(in_features=128, out_features=1, bias=True)
   )
 ), 'final_activation': None, 'is_fitted_': True})
 
 12-) network_init: 
    XavierInit
 
 13-) optimizer: 
    Adam ({'random_state': RandomState(MT19937) at 0x19465E140, '_fit_requirements': [FitRequirement(name='network', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False)], '_cs_updates': {}, 'optimizer': Adam (
 Parameter Group 0
     amsgrad: False
     betas: (0.9, 0.9)
     capturable: False
     eps: 1e-08
     foreach: None
     lr: 0.01
     maximize: False
     weight_decay: 0.0
 ), 'lr': 0.01, 'beta1': 0.9, 'beta2': 0.9, 'weight_decay': 0.0})
 
 14-) lr_scheduler: 
    ReduceLROnPlateau
 
 15-) data_loader: 
    DataLoader
 
 16-) trainer: 
    autoPyTorch.pipeline Standard Trainer
 
 ________________________________________)</code></pre>
</div>
</div>
<div id="e8a28ec2" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>api.get_models_with_weights()[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>(0.16,
 MyTraditionalTabularRegressionPipeline(config='svm',
                                        dataset_properties={'categorical_columns': [],
                                                            'categories': [],
                                                            'input_shape': (10,),
                                                            'is_small_preprocess': True,
                                                            'issigned': True,
                                                            'issparse': False,
                                                            'numerical_columns': [0,
                                                                                  1,
                                                                                  2,
                                                                                  3,
                                                                                  4,
                                                                                  5,
                                                                                  6,
                                                                                  7,
                                                                                  8,
                                                                                  9],
                                                            'output_shape': 1,
                                                            'output_type': 'continuous',
                                                            'target_type': 'tabular_regression',
                                                            'task_type': 'tabular_regression'},
                                        init_params={'instance': None},
                                        random_state=RandomState(MT19937) at 0x194711B40))</code></pre>
</div>
</div>
<p>What if we fit only NNs?</p>
<div id="9830034c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>api2 <span class="op">=</span> TabularRegressionTask(seed<span class="op">=</span><span class="dv">2</span>, ensemble_size<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>api2.search(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    X_train<span class="op">=</span>X_train,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    y_train<span class="op">=</span>y_train,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    X_test<span class="op">=</span>X_test.copy(),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    y_test<span class="op">=</span>y_test.copy(),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    optimize_metric<span class="op">=</span><span class="st">'r2'</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    total_walltime_limit<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    func_eval_time_limit_secs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    dataset_name<span class="op">=</span><span class="st">"Diabetes"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    memory_limit<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    enable_traditional_pipeline<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[WARNING] [2023-02-27 18:29:06,260:Client-autoPyTorch.automl_common.common.utils.backend] Directory /var/folders/1x/wmgn24mn1bbd2vgbqlk98tbc0000gn/T/autoPyTorch_tmp_70d9fdb4-b69e-11ed-b5ea-3c7d0a00e5d9/.autoPyTorch/ensembles does not exist
[ERROR] [2023-02-27 18:29:06,261:Client-AutoPyTorch:Diabetes:2] No valid ensemble was created. Please check the logfile for errors. Default to the best individual estimator:[(2, 2, 5.555555555555555)]
NoneType: None</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>&lt;autoPyTorch.api.tabular_regression.TabularRegressionTask at 0x194d3f160&gt;</code></pre>
</div>
</div>
<div id="6ca70344" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="op">=</span> api2.predict(X_test)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>score2 <span class="op">=</span> api2.score(y_pred2, y_test)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>score2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>{'r2': -0.37656772470491995}</code></pre>
</div>
</div>
<div id="44a5fe8a" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(y_test, y_pred2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>84.77782906691597</code></pre>
</div>
</div>
<p>Okay, it seems we are worse than the random forest. Let’s see what happened.</p>
<div id="2f00b22b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>api2.get_models_with_weights()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(1.0,
 ________________________________________
    TabularRegressionPipeline
 ________________________________________
 0-) imputer: 
    SimpleImputer
 
 1-) variance_threshold: 
    VarianceThreshold
 
 2-) coalescer: 
    NoCoalescer
 
 3-) encoder: 
    NoEncoder
 
 4-) scaler: 
    StandardScaler
 
 5-) feature_preprocessor: 
    NoFeaturePreprocessor
 
 6-) tabular_transformer: 
    TabularColumnTransformer
 
 7-) preprocessing: 
    EarlyPreprocessing
 
 8-) network_embedding: 
    autoPyTorch.pipeline NoEmbedding
 
 9-) network_backbone: 
    autoPyTorch.pipeline ShapedMLPBackbone
 
 10-) network_head: 
    autoPyTorch.pipeline FullyConnectedHead
 
 11-) network: 
    Sequential ({'random_state': RandomState(MT19937) at 0x194711A40, '_fit_requirements': [FitRequirement(name='network_head', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False), FitRequirement(name='network_backbone', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False), FitRequirement(name='network_embedding', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False)], '_cs_updates': {}, 'device': device(type='cpu'), 'network': Sequential(
   (0): _NoEmbedding()
   (1): Sequential(
     (0): Linear(in_features=10, out_features=200, bias=True)
     (1): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (2): ReLU()
     (3): Linear(in_features=200, out_features=200, bias=True)
     (4): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (5): ReLU()
     (6): Linear(in_features=200, out_features=200, bias=True)
     (7): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (8): ReLU()
     (9): Linear(in_features=200, out_features=200, bias=True)
     (10): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
     (11): ReLU()
     (12): Linear(in_features=200, out_features=200, bias=True)
   )
   (2): Sequential(
     (0): Flatten(start_dim=1, end_dim=-1)
     (1): Linear(in_features=200, out_features=128, bias=True)
     (2): ReLU()
     (3): Linear(in_features=128, out_features=1, bias=True)
   )
 ), 'final_activation': None, 'is_fitted_': True})
 
 12-) network_init: 
    XavierInit
 
 13-) optimizer: 
    Adam ({'random_state': RandomState(MT19937) at 0x194711A40, '_fit_requirements': [FitRequirement(name='network', supported_types=(&lt;class 'torch.nn.modules.module.Module'&gt;,), user_defined=False, dataset_property=False)], '_cs_updates': {}, 'optimizer': Adam (
 Parameter Group 0
     amsgrad: False
     betas: (0.9, 0.9)
     capturable: False
     eps: 1e-08
     foreach: None
     lr: 0.01
     maximize: False
     weight_decay: 0.0
 ), 'lr': 0.01, 'beta1': 0.9, 'beta2': 0.9, 'weight_decay': 0.0})
 
 14-) lr_scheduler: 
    ReduceLROnPlateau
 
 15-) data_loader: 
    DataLoader
 
 16-) trainer: 
    autoPyTorch.pipeline Standard Trainer
 
 ________________________________________)</code></pre>
</div>
</div>
<div id="661059be" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>X_train_torch <span class="op">=</span> torch.from_numpy(X_train.values).<span class="bu">float</span>()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>y_train_torch <span class="op">=</span> torch.from_numpy(y_train.values).<span class="bu">float</span>()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>X_val_torch <span class="op">=</span> torch.from_numpy(X_valid.values).<span class="bu">float</span>()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>y_val_torch <span class="op">=</span> torch.from_numpy(y_valid.values).<span class="bu">float</span>()</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>X_test_torch <span class="op">=</span> torch.from_numpy(X_test.values).<span class="bu">float</span>()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>y_test_torch <span class="op">=</span> torch.from_numpy(y_test.values).<span class="bu">float</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5fd5139d" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a simple MLP in PyTorch, train on training data and optimize on validation data</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Net(nn.Module):</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, l1 <span class="op">=</span> <span class="dv">64</span>, l2 <span class="op">=</span> <span class="dv">64</span>, l3 <span class="op">=</span> <span class="dv">64</span>, l2_reg <span class="op">=</span> <span class="fl">0.0</span>):</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Net, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2_reg <span class="op">=</span> l2_reg</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc1 <span class="op">=</span> nn.Linear(<span class="dv">10</span>, l1)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc2 <span class="op">=</span> nn.Linear(l1, l2)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc3 <span class="op">=</span> nn.Linear(l2, l3)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc4 <span class="op">=</span> nn.Linear(l3, <span class="dv">1</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a residual connection</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> F.relu(<span class="va">self</span>.fc1(x))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> F.relu(<span class="va">self</span>.fc2(x))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> F.relu(<span class="va">self</span>.fc3(x))</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.fc4(x)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Net()</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(net.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>train_losses <span class="op">=</span> []</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>val_losses <span class="op">=</span> []</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>test_losses <span class="op">=</span> []</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):  <span class="co"># loop over the dataset multiple times and store the train, test loss</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_train_torch)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(outputs, y_train_torch)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add L2 regularization</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">+=</span> net.l2_reg <span class="op">*</span> torch.norm(param)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    train_losses.append(np.sqrt(loss.item()))</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    val_losses.append(np.sqrt(criterion(net(X_val_torch), y_val_torch).item()))</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    test_losses.append(np.sqrt(criterion(net(X_test_torch), y_test_torch).item()))</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Finished Training'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished Training</code></pre>
</div>
</div>
<div id="bd43a5de" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plt.plot(train_losses, label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plt.plot(test_losses, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.plot(val_losses, label<span class="op">=</span><span class="st">"Val"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="nas_files/figure-html/cell-23-output-1.png" width="566" height="422" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7c2e3cdc" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_test_torch)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(outputs, y_test_torch)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Test loss: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(loss.item())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_train_torch)    </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(outputs, y_train_torch)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Train loss: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(loss.item())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test loss: 72.43299031475574
Train loss: 79.2251754050993
</code></pre>
</div>
</div>
<div id="a96d7d46" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the NN model using scaled y values</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using sklearn's StandardScaler to scale the y values</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>y_train_scaled <span class="op">=</span> scaler.fit_transform(y_train.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>y_train_scaled <span class="op">=</span> torch.from_numpy(y_train_scaled).<span class="bu">float</span>()</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>y_test_scaled <span class="op">=</span> scaler.transform(y_test.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>y_test_scaled <span class="op">=</span> torch.from_numpy(y_test_scaled).<span class="bu">float</span>()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>y_valid_scaled <span class="op">=</span> scaler.transform(y_valid.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>y_valid_scaled <span class="op">=</span> torch.from_numpy(y_valid_scaled).<span class="bu">float</span>()</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Net()</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(net.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>train_losses <span class="op">=</span> []</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>val_losses <span class="op">=</span> []</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>test_losses <span class="op">=</span> []</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4000</span>):  <span class="co"># loop over the dataset multiple times and store the train, test loss</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_train_torch)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(outputs, y_train_scaled)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add L2 regularization</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">+=</span> net.l2_reg <span class="op">*</span> torch.norm(param)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    train_losses.append(np.sqrt(loss.item()))</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Finished Training'</span>)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished Training</code></pre>
</div>
</div>
<div id="30d415c1" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plt.plot(train_losses, label<span class="op">=</span><span class="st">"Train"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="nas_files/figure-html/cell-26-output-1.png" width="559" height="422" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7b962e2f" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the scaled y values and inverse transform them to get the original y values</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_test_torch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="34d14921" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse transform the scaled y values to get the original y values</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> scaler.inverse_transform(outputs.numpy())</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> y_pred.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mean_squared_error(y_test, y_pred))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test RMSE: 82.79070717489064</code></pre>
</div>
</div>
<div id="9cc481b0" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"y_test"</span>: y_test, <span class="st">"y_pred"</span>: y_pred}).plot.scatter(x<span class="op">=</span><span class="st">"y_test"</span>, y<span class="op">=</span><span class="st">"y_pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="nas_files/figure-html/cell-29-output-1.png" width="591" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a6e7e23f" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At this point it seems our model is worse than RF, Auto model containing Catboost etc. Let us optimize our NN</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I will use Ray Tune to optimize the hyperparameters</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ray</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ray <span class="im">import</span> tune</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ray.tune <span class="im">import</span> CLIReporter</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ray.tune.schedulers <span class="im">import</span> ASHAScheduler</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_mlp(config):</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> Net(config[<span class="st">"l1"</span>], config[<span class="st">"l2"</span>], config[<span class="st">"l3"</span>], config[<span class="st">"l2_reg"</span>])</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam(net.parameters(), lr<span class="op">=</span>config[<span class="st">"lr"</span>])</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):  <span class="co"># loop over the dataset multiple times and store the train, test loss</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> net(X_train_torch)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, y_train_scaled)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add l2 regularization to loss</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        l2_reg <span class="op">=</span> torch.tensor(<span class="fl">0.</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>            l2_reg <span class="op">+=</span> torch.norm(param)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">+=</span> config[<span class="st">"l2_reg"</span>] <span class="op">*</span> l2_reg</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> net(X_val_torch)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Inverse transform the scaled y values to get the original y values</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> scaler.inverse_transform(outputs.numpy())</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> np.sqrt(mean_squared_error(y_valid, y_pred))</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"loss"</span>: loss, <span class="st">"status"</span>: <span class="st">"ok"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7d9c778f" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ray.shutdown()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ray.init()</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>scheduler <span class="op">=</span> ASHAScheduler(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">"loss"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"min"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    max_t<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    grace_period<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    reduction_factor<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>reporter <span class="op">=</span> CLIReporter(</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    parameter_columns<span class="op">=</span>[<span class="st">"l1"</span>, <span class="st">"l2"</span>, <span class="st">"l3"</span>, <span class="st">"lr"</span>, <span class="st">"l2_reg"</span>],</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    metric_columns<span class="op">=</span>[<span class="st">"loss"</span>, <span class="st">"training_iteration"</span>])</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>analysis <span class="op">=</span> tune.run(</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    train_mlp,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    resources_per_trial<span class="op">=</span>{<span class="st">"cpu"</span>: <span class="dv">1</span>},</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>{</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"l1"</span>: tune.choice([<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"l2"</span>: tune.choice([<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"l3"</span>: tune.choice([<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]),</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"l2_reg"</span>: tune.loguniform(<span class="fl">1e-4</span>, <span class="fl">1.0</span>),</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lr"</span>: tune.loguniform(<span class="fl">1e-4</span>, <span class="fl">1.0</span>),</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    num_samples<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    scheduler<span class="op">=</span>scheduler,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    progress_reporter<span class="op">=</span>reporter)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="trialProgress">
  <h3 class="anchored">Trial Progress</h3>
  
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Trial name</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">done</th>
<th data-quarto-table-cell-role="th">episodes_total</th>
<th data-quarto-table-cell-role="th">experiment_id</th>
<th data-quarto-table-cell-role="th">hostname</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">iterations_since_restore</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">loss</th>
<th data-quarto-table-cell-role="th">node_ip</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pid</th>
<th data-quarto-table-cell-role="th">status</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">time_since_restore</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">time_this_iter_s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">time_total_s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">timestamp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">timesteps_since_restore</th>
<th data-quarto-table-cell-role="th">timesteps_total</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">training_iteration</th>
<th data-quarto-table-cell-role="th">trial_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">warmup_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>train_mlp_c8d42_00000</td>
<td>2023-02-28_10-08-51</td>
<td>True</td>
<td></td>
<td>684a45c7048544b384d756bd20117055</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2275</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99588</td>
<td>ok</td>
<td style="text-align: right;">2.44738</td>
<td style="text-align: right;">2.44738</td>
<td style="text-align: right;">2.44738</td>
<td style="text-align: right;">1677559131</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00000</td>
<td style="text-align: right;">0.00341606</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00001</td>
<td>2023-02-28_10-08-59</td>
<td>True</td>
<td></td>
<td>23a98dd3be3d4ad2abbc0a44970bd41b</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2183</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99594</td>
<td>ok</td>
<td style="text-align: right;">4.5987</td>
<td style="text-align: right;">4.5987</td>
<td style="text-align: right;">4.5987</td>
<td style="text-align: right;">1677559139</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00001</td>
<td style="text-align: right;">0.00891805</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00002</td>
<td>2023-02-28_10-08-58</td>
<td>True</td>
<td></td>
<td>f1614c13b37a4966adb785c911a54c11</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2261</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99595</td>
<td>ok</td>
<td style="text-align: right;">2.89705</td>
<td style="text-align: right;">2.89705</td>
<td style="text-align: right;">2.89705</td>
<td style="text-align: right;">1677559138</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00002</td>
<td style="text-align: right;">0.0356119</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00003</td>
<td>2023-02-28_10-08-57</td>
<td>True</td>
<td></td>
<td>e9475ee5dd1f4d1289ef144d1a7879ad</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.6545</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99596</td>
<td>ok</td>
<td style="text-align: right;">2.83387</td>
<td style="text-align: right;">2.83387</td>
<td style="text-align: right;">2.83387</td>
<td style="text-align: right;">1677559137</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00003</td>
<td style="text-align: right;">0.00670218</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00004</td>
<td>2023-02-28_10-08-57</td>
<td>True</td>
<td></td>
<td>97bdec82d1ec44069bc84210c4a6a18e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">65.3017</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99597</td>
<td>ok</td>
<td style="text-align: right;">2.6755</td>
<td style="text-align: right;">2.6755</td>
<td style="text-align: right;">2.6755</td>
<td style="text-align: right;">1677559137</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00004</td>
<td style="text-align: right;">0.00920701</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00005</td>
<td>2023-02-28_10-08-59</td>
<td>True</td>
<td></td>
<td>3db458192e6944118049623bfe3128a4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.1747</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99598</td>
<td>ok</td>
<td style="text-align: right;">4.36245</td>
<td style="text-align: right;">4.36245</td>
<td style="text-align: right;">4.36245</td>
<td style="text-align: right;">1677559139</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00005</td>
<td style="text-align: right;">0.00544381</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00006</td>
<td>2023-02-28_10-08-59</td>
<td>True</td>
<td></td>
<td>6b794ba131304c9e841b2d671a1a4693</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2181</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99601</td>
<td>ok</td>
<td style="text-align: right;">4.51009</td>
<td style="text-align: right;">4.51009</td>
<td style="text-align: right;">4.51009</td>
<td style="text-align: right;">1677559139</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00006</td>
<td style="text-align: right;">0.00939798</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00007</td>
<td>2023-02-28_10-09-06</td>
<td>True</td>
<td></td>
<td>38d637c01fcb43d3be8db783cb837ea2</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.7874</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99602</td>
<td>ok</td>
<td style="text-align: right;">11.1744</td>
<td style="text-align: right;">11.1744</td>
<td style="text-align: right;">11.1744</td>
<td style="text-align: right;">1677559146</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00007</td>
<td style="text-align: right;">0.012325</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00008</td>
<td>2023-02-28_10-09-00</td>
<td>True</td>
<td></td>
<td>a15c3445ce1e4ffeba2eabf9098820f2</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.1934</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99604</td>
<td>ok</td>
<td style="text-align: right;">4.98043</td>
<td style="text-align: right;">4.98043</td>
<td style="text-align: right;">4.98043</td>
<td style="text-align: right;">1677559140</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00008</td>
<td style="text-align: right;">0.010926</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00009</td>
<td>2023-02-28_10-09-00</td>
<td>True</td>
<td></td>
<td>9de7e974434443f6a12e1dbc614a8582</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">68.2169</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99612</td>
<td>ok</td>
<td style="text-align: right;">5.00434</td>
<td style="text-align: right;">5.00434</td>
<td style="text-align: right;">5.00434</td>
<td style="text-align: right;">1677559140</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00009</td>
<td style="text-align: right;">0.00496888</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00010</td>
<td>2023-02-28_10-09-00</td>
<td>True</td>
<td></td>
<td>d7fa3bf71c4d44dd90e2988c0e59687a</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2198</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99613</td>
<td>ok</td>
<td style="text-align: right;">5.70828</td>
<td style="text-align: right;">5.70828</td>
<td style="text-align: right;">5.70828</td>
<td style="text-align: right;">1677559140</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00010</td>
<td style="text-align: right;">0.00938773</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00011</td>
<td>2023-02-28_10-09-03</td>
<td>True</td>
<td></td>
<td>6e08564fbc6d4f5c9bea59429a196a5e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52.2075</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99614</td>
<td>ok</td>
<td style="text-align: right;">8.02228</td>
<td style="text-align: right;">8.02228</td>
<td style="text-align: right;">8.02228</td>
<td style="text-align: right;">1677559143</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00011</td>
<td style="text-align: right;">0.00922298</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00012</td>
<td>2023-02-28_10-08-59</td>
<td>True</td>
<td></td>
<td>98349fab3a1b4027bc14d3ce239251fd</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.1125</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99615</td>
<td>ok</td>
<td style="text-align: right;">4.87773</td>
<td style="text-align: right;">4.87773</td>
<td style="text-align: right;">4.87773</td>
<td style="text-align: right;">1677559139</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00012</td>
<td style="text-align: right;">0.00547719</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00013</td>
<td>2023-02-28_10-08-58</td>
<td>True</td>
<td></td>
<td>6356d7d5564f49ac84f1f5221bccaa3e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2163</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99616</td>
<td>ok</td>
<td style="text-align: right;">3.31126</td>
<td style="text-align: right;">3.31126</td>
<td style="text-align: right;">3.31126</td>
<td style="text-align: right;">1677559138</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00013</td>
<td style="text-align: right;">0.0112782</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00014</td>
<td>2023-02-28_10-09-00</td>
<td>True</td>
<td></td>
<td>e4c8bef4a7e246c19960353c87f60541</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2002</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99617</td>
<td>ok</td>
<td style="text-align: right;">5.44697</td>
<td style="text-align: right;">5.44697</td>
<td style="text-align: right;">5.44697</td>
<td style="text-align: right;">1677559140</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00014</td>
<td style="text-align: right;">0.0142629</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00015</td>
<td>2023-02-28_10-09-01</td>
<td>True</td>
<td></td>
<td>f91e68c1ff9a486f9f74c54403e236f4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.5808</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99618</td>
<td>ok</td>
<td style="text-align: right;">5.94224</td>
<td style="text-align: right;">5.94224</td>
<td style="text-align: right;">5.94224</td>
<td style="text-align: right;">1677559141</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00015</td>
<td style="text-align: right;">0.00973487</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00016</td>
<td>2023-02-28_10-08-59</td>
<td>True</td>
<td></td>
<td>684a45c7048544b384d756bd20117055</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">85.4019</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99588</td>
<td>ok</td>
<td style="text-align: right;">4.64298</td>
<td style="text-align: right;">4.64298</td>
<td style="text-align: right;">4.64298</td>
<td style="text-align: right;">1677559139</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00016</td>
<td style="text-align: right;">0.00341606</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00017</td>
<td>2023-02-28_10-09-01</td>
<td>True</td>
<td></td>
<td>97bdec82d1ec44069bc84210c4a6a18e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2217</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99597</td>
<td>ok</td>
<td style="text-align: right;">3.26168</td>
<td style="text-align: right;">3.26168</td>
<td style="text-align: right;">3.26168</td>
<td style="text-align: right;">1677559141</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00017</td>
<td style="text-align: right;">0.00920701</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00018</td>
<td>2023-02-28_10-09-00</td>
<td>True</td>
<td></td>
<td>e9475ee5dd1f4d1289ef144d1a7879ad</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52.4798</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99596</td>
<td>ok</td>
<td style="text-align: right;">2.94631</td>
<td style="text-align: right;">2.94631</td>
<td style="text-align: right;">2.94631</td>
<td style="text-align: right;">1677559140</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00018</td>
<td style="text-align: right;">0.00670218</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00019</td>
<td>2023-02-28_10-09-10</td>
<td>True</td>
<td></td>
<td>f1614c13b37a4966adb785c911a54c11</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.5559</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99595</td>
<td>ok</td>
<td style="text-align: right;">12.1603</td>
<td style="text-align: right;">12.1603</td>
<td style="text-align: right;">12.1603</td>
<td style="text-align: right;">1677559150</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00019</td>
<td style="text-align: right;">0.0356119</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00020</td>
<td>2023-02-28_10-09-04</td>
<td>True</td>
<td></td>
<td>6356d7d5564f49ac84f1f5221bccaa3e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">54.8401</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99616</td>
<td>ok</td>
<td style="text-align: right;">5.67631</td>
<td style="text-align: right;">5.67631</td>
<td style="text-align: right;">5.67631</td>
<td style="text-align: right;">1677559144</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00020</td>
<td style="text-align: right;">0.0112782</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00021</td>
<td>2023-02-28_10-09-03</td>
<td>True</td>
<td></td>
<td>3db458192e6944118049623bfe3128a4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">80.9971</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99598</td>
<td>ok</td>
<td style="text-align: right;">4.02288</td>
<td style="text-align: right;">4.02288</td>
<td style="text-align: right;">4.02288</td>
<td style="text-align: right;">1677559143</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00021</td>
<td style="text-align: right;">0.00544381</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00022</td>
<td>2023-02-28_10-09-04</td>
<td>True</td>
<td></td>
<td>6b794ba131304c9e841b2d671a1a4693</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">62.7729</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99601</td>
<td>ok</td>
<td style="text-align: right;">5.19184</td>
<td style="text-align: right;">5.19184</td>
<td style="text-align: right;">5.19184</td>
<td style="text-align: right;">1677559144</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00022</td>
<td style="text-align: right;">0.00939798</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00023</td>
<td>2023-02-28_10-09-03</td>
<td>True</td>
<td></td>
<td>23a98dd3be3d4ad2abbc0a44970bd41b</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52.487</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99594</td>
<td>ok</td>
<td style="text-align: right;">3.83576</td>
<td style="text-align: right;">3.83576</td>
<td style="text-align: right;">3.83576</td>
<td style="text-align: right;">1677559143</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00023</td>
<td style="text-align: right;">0.00891805</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00024</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>684a45c7048544b384d756bd20117055</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.1853</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99588</td>
<td>ok</td>
<td style="text-align: right;">10.1193</td>
<td style="text-align: right;">10.1193</td>
<td style="text-align: right;">10.1193</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00024</td>
<td style="text-align: right;">0.00341606</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00025</td>
<td>2023-02-28_10-09-04</td>
<td>True</td>
<td></td>
<td>98349fab3a1b4027bc14d3ce239251fd</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2173</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99615</td>
<td>ok</td>
<td style="text-align: right;">4.14031</td>
<td style="text-align: right;">4.14031</td>
<td style="text-align: right;">4.14031</td>
<td style="text-align: right;">1677559144</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00025</td>
<td style="text-align: right;">0.00547719</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00026</td>
<td>2023-02-28_10-09-06</td>
<td>True</td>
<td></td>
<td>a15c3445ce1e4ffeba2eabf9098820f2</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">68.3927</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99604</td>
<td>ok</td>
<td style="text-align: right;">6.18441</td>
<td style="text-align: right;">6.18441</td>
<td style="text-align: right;">6.18441</td>
<td style="text-align: right;">1677559146</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00026</td>
<td style="text-align: right;">0.010926</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00027</td>
<td>2023-02-28_10-09-03</td>
<td>True</td>
<td></td>
<td>9de7e974434443f6a12e1dbc614a8582</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.218</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99612</td>
<td>ok</td>
<td style="text-align: right;">3.01754</td>
<td style="text-align: right;">3.01754</td>
<td style="text-align: right;">3.01754</td>
<td style="text-align: right;">1677559143</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00027</td>
<td style="text-align: right;">0.00496888</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00028</td>
<td>2023-02-28_10-09-06</td>
<td>True</td>
<td></td>
<td>e4c8bef4a7e246c19960353c87f60541</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">66.4336</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99617</td>
<td>ok</td>
<td style="text-align: right;">5.79445</td>
<td style="text-align: right;">5.79445</td>
<td style="text-align: right;">5.79445</td>
<td style="text-align: right;">1677559146</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00028</td>
<td style="text-align: right;">0.0142629</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00029</td>
<td>2023-02-28_10-09-03</td>
<td>True</td>
<td></td>
<td>d7fa3bf71c4d44dd90e2988c0e59687a</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2164</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99613</td>
<td>ok</td>
<td style="text-align: right;">2.94911</td>
<td style="text-align: right;">2.94911</td>
<td style="text-align: right;">2.94911</td>
<td style="text-align: right;">1677559143</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00029</td>
<td style="text-align: right;">0.00938773</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00030</td>
<td>2023-02-28_10-09-05</td>
<td>True</td>
<td></td>
<td>e9475ee5dd1f4d1289ef144d1a7879ad</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">75.2123</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99596</td>
<td>ok</td>
<td style="text-align: right;">4.99429</td>
<td style="text-align: right;">4.99429</td>
<td style="text-align: right;">4.99429</td>
<td style="text-align: right;">1677559145</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00030</td>
<td style="text-align: right;">0.00670218</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00031</td>
<td>2023-02-28_10-09-06</td>
<td>True</td>
<td></td>
<td>f91e68c1ff9a486f9f74c54403e236f4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.925</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99618</td>
<td>ok</td>
<td style="text-align: right;">4.96918</td>
<td style="text-align: right;">4.96918</td>
<td style="text-align: right;">4.96918</td>
<td style="text-align: right;">1677559146</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00031</td>
<td style="text-align: right;">0.00973487</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00032</td>
<td>2023-02-28_10-09-04</td>
<td>True</td>
<td></td>
<td>97bdec82d1ec44069bc84210c4a6a18e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.4117</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99597</td>
<td>ok</td>
<td style="text-align: right;">3.24968</td>
<td style="text-align: right;">3.24968</td>
<td style="text-align: right;">3.24968</td>
<td style="text-align: right;">1677559144</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00032</td>
<td style="text-align: right;">0.00920701</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00033</td>
<td>2023-02-28_10-09-08</td>
<td>True</td>
<td></td>
<td>6e08564fbc6d4f5c9bea59429a196a5e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70.9285</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99614</td>
<td>ok</td>
<td style="text-align: right;">5.80603</td>
<td style="text-align: right;">5.80603</td>
<td style="text-align: right;">5.80603</td>
<td style="text-align: right;">1677559148</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00033</td>
<td style="text-align: right;">0.00922298</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00034</td>
<td>2023-02-28_10-09-08</td>
<td>True</td>
<td></td>
<td>9de7e974434443f6a12e1dbc614a8582</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.9675</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99612</td>
<td>ok</td>
<td style="text-align: right;">5.20552</td>
<td style="text-align: right;">5.20552</td>
<td style="text-align: right;">5.20552</td>
<td style="text-align: right;">1677559148</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00034</td>
<td style="text-align: right;">0.00496888</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00035</td>
<td>2023-02-28_10-09-07</td>
<td>True</td>
<td></td>
<td>3db458192e6944118049623bfe3128a4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.1776</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99598</td>
<td>ok</td>
<td style="text-align: right;">3.86612</td>
<td style="text-align: right;">3.86612</td>
<td style="text-align: right;">3.86612</td>
<td style="text-align: right;">1677559147</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00035</td>
<td style="text-align: right;">0.00544381</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00036</td>
<td>2023-02-28_10-09-07</td>
<td>True</td>
<td></td>
<td>23a98dd3be3d4ad2abbc0a44970bd41b</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2167</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99594</td>
<td>ok</td>
<td style="text-align: right;">3.56161</td>
<td style="text-align: right;">3.56161</td>
<td style="text-align: right;">3.56161</td>
<td style="text-align: right;">1677559147</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00036</td>
<td style="text-align: right;">0.00891805</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00037</td>
<td>2023-02-28_10-09-07</td>
<td>True</td>
<td></td>
<td>d7fa3bf71c4d44dd90e2988c0e59687a</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.8721</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99613</td>
<td>ok</td>
<td style="text-align: right;">4.08222</td>
<td style="text-align: right;">4.08222</td>
<td style="text-align: right;">4.08222</td>
<td style="text-align: right;">1677559147</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00037</td>
<td style="text-align: right;">0.00938773</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00038</td>
<td>2023-02-28_10-09-10</td>
<td>True</td>
<td></td>
<td>98349fab3a1b4027bc14d3ce239251fd</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2166</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99615</td>
<td>ok</td>
<td style="text-align: right;">6.54892</td>
<td style="text-align: right;">6.54892</td>
<td style="text-align: right;">6.54892</td>
<td style="text-align: right;">1677559150</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00038</td>
<td style="text-align: right;">0.00547719</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00039</td>
<td>2023-02-28_10-09-07</td>
<td>True</td>
<td></td>
<td>6356d7d5564f49ac84f1f5221bccaa3e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">71.0616</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99616</td>
<td>ok</td>
<td style="text-align: right;">3.14067</td>
<td style="text-align: right;">3.14067</td>
<td style="text-align: right;">3.14067</td>
<td style="text-align: right;">1677559147</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00039</td>
<td style="text-align: right;">0.0112782</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00040</td>
<td>2023-02-28_10-09-07</td>
<td>True</td>
<td></td>
<td>97bdec82d1ec44069bc84210c4a6a18e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">78.2332</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99597</td>
<td>ok</td>
<td style="text-align: right;">3.1038</td>
<td style="text-align: right;">3.1038</td>
<td style="text-align: right;">3.1038</td>
<td style="text-align: right;">1677559147</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00040</td>
<td style="text-align: right;">0.00920701</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00041</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>6b794ba131304c9e841b2d671a1a4693</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2681</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99601</td>
<td>ok</td>
<td style="text-align: right;">4.69843</td>
<td style="text-align: right;">4.69843</td>
<td style="text-align: right;">4.69843</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00041</td>
<td style="text-align: right;">0.00939798</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00042</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>e9475ee5dd1f4d1289ef144d1a7879ad</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">64.8587</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99596</td>
<td>ok</td>
<td style="text-align: right;">3.2481</td>
<td style="text-align: right;">3.2481</td>
<td style="text-align: right;">3.2481</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00042</td>
<td style="text-align: right;">0.00670218</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00043</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>f91e68c1ff9a486f9f74c54403e236f4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2166</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99618</td>
<td>ok</td>
<td style="text-align: right;">2.99345</td>
<td style="text-align: right;">2.99345</td>
<td style="text-align: right;">2.99345</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00043</td>
<td style="text-align: right;">0.00973487</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00044</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>38d637c01fcb43d3be8db783cb837ea2</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2244</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99602</td>
<td>ok</td>
<td style="text-align: right;">3.30911</td>
<td style="text-align: right;">3.30911</td>
<td style="text-align: right;">3.30911</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00044</td>
<td style="text-align: right;">0.012325</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00045</td>
<td>2023-02-28_10-09-10</td>
<td>True</td>
<td></td>
<td>a15c3445ce1e4ffeba2eabf9098820f2</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.9337</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99604</td>
<td>ok</td>
<td style="text-align: right;">3.84642</td>
<td style="text-align: right;">3.84642</td>
<td style="text-align: right;">3.84642</td>
<td style="text-align: right;">1677559150</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00045</td>
<td style="text-align: right;">0.010926</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00046</td>
<td>2023-02-28_10-09-10</td>
<td>True</td>
<td></td>
<td>e4c8bef4a7e246c19960353c87f60541</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2167</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99617</td>
<td>ok</td>
<td style="text-align: right;">3.67529</td>
<td style="text-align: right;">3.67529</td>
<td style="text-align: right;">3.67529</td>
<td style="text-align: right;">1677559150</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00046</td>
<td style="text-align: right;">0.0142629</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00047</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>23a98dd3be3d4ad2abbc0a44970bd41b</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">73.6947</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99594</td>
<td>ok</td>
<td style="text-align: right;">2.20929</td>
<td style="text-align: right;">2.20929</td>
<td style="text-align: right;">2.20929</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00047</td>
<td style="text-align: right;">0.00891805</td>
</tr>
<tr class="odd">
<td>train_mlp_c8d42_00048</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>6356d7d5564f49ac84f1f5221bccaa3e</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76.2164</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99616</td>
<td>ok</td>
<td style="text-align: right;">2.29378</td>
<td style="text-align: right;">2.29378</td>
<td style="text-align: right;">2.29378</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00048</td>
<td style="text-align: right;">0.0112782</td>
</tr>
<tr class="even">
<td>train_mlp_c8d42_00049</td>
<td>2023-02-28_10-09-09</td>
<td>True</td>
<td></td>
<td>3db458192e6944118049623bfe3128a4</td>
<td>Nipuns-iMac-8.local</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">60.3637</td>
<td>127.0.0.1</td>
<td style="text-align: right;">99598</td>
<td>ok</td>
<td style="text-align: right;">2.2852</td>
<td style="text-align: right;">2.2852</td>
<td style="text-align: right;">2.2852</td>
<td style="text-align: right;">1677559149</td>
<td style="text-align: right;">0</td>
<td></td>
<td style="text-align: right;">1</td>
<td>c8d42_00049</td>
<td style="text-align: right;">0.00544381</td>
</tr>
</tbody>
</table>

</div>
<style>
.trialProgress {
  display: flex;
  flex-direction: column;
  color: var(--jp-ui-font-color1);
}
.trialProgress h3 {
  font-weight: bold;
}
.trialProgress td {
  white-space: nowrap;
}
</style>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-02-28 10:09:11,027 INFO tune.py:762 -- Total run time: 26.09 seconds (25.84 seconds for the tuning loop).</code></pre>
</div>
</div>
<div id="535a30ba" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the table for all the trials</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> analysis.results_df</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the table by loss</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">"loss"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show only loss, config/l1, config/l2, config/l3, config/lr, training_iteration</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"loss"</span>, <span class="st">"config/l1"</span>, <span class="st">"config/l2"</span>, <span class="st">"config/l3"</span>, <span class="st">"config/lr"</span>, <span class="st">"config/l2_reg"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loss</th>
<th data-quarto-table-cell-role="th">config/l1</th>
<th data-quarto-table-cell-role="th">config/l2</th>
<th data-quarto-table-cell-role="th">config/l3</th>
<th data-quarto-table-cell-role="th">config/lr</th>
<th data-quarto-table-cell-role="th">config/l2_reg</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">trial_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00019</td>
<td>51.555930</td>
<td>256</td>
<td>256</td>
<td>128</td>
<td>0.000125</td>
<td>0.027615</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00015</td>
<td>51.580817</td>
<td>4</td>
<td>64</td>
<td>256</td>
<td>0.003980</td>
<td>0.015450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00003</td>
<td>51.654479</td>
<td>2</td>
<td>64</td>
<td>4</td>
<td>0.000991</td>
<td>0.015054</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00037</td>
<td>51.872128</td>
<td>128</td>
<td>32</td>
<td>32</td>
<td>0.000114</td>
<td>0.005181</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00031</td>
<td>51.925027</td>
<td>128</td>
<td>64</td>
<td>32</td>
<td>0.000103</td>
<td>0.001919</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00045</td>
<td>51.933658</td>
<td>64</td>
<td>256</td>
<td>16</td>
<td>0.000139</td>
<td>0.000221</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00034</td>
<td>51.967532</td>
<td>2</td>
<td>128</td>
<td>128</td>
<td>0.000371</td>
<td>0.000860</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00011</td>
<td>52.207469</td>
<td>16</td>
<td>256</td>
<td>128</td>
<td>0.000134</td>
<td>0.001002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00018</td>
<td>52.479806</td>
<td>2</td>
<td>16</td>
<td>4</td>
<td>0.002317</td>
<td>0.000166</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00023</td>
<td>52.486995</td>
<td>64</td>
<td>64</td>
<td>16</td>
<td>0.000214</td>
<td>0.025084</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00020</td>
<td>54.840118</td>
<td>2</td>
<td>128</td>
<td>128</td>
<td>0.001178</td>
<td>0.001264</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00049</td>
<td>60.363672</td>
<td>4</td>
<td>128</td>
<td>16</td>
<td>0.003238</td>
<td>0.000639</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00022</td>
<td>62.772853</td>
<td>256</td>
<td>4</td>
<td>64</td>
<td>0.000419</td>
<td>0.000484</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00042</td>
<td>64.858708</td>
<td>128</td>
<td>32</td>
<td>2</td>
<td>0.001164</td>
<td>0.000313</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00004</td>
<td>65.301650</td>
<td>4</td>
<td>2</td>
<td>32</td>
<td>0.071916</td>
<td>0.000168</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00028</td>
<td>66.433568</td>
<td>128</td>
<td>64</td>
<td>128</td>
<td>0.013376</td>
<td>0.002368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00009</td>
<td>68.216911</td>
<td>32</td>
<td>256</td>
<td>2</td>
<td>0.000931</td>
<td>0.001888</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00026</td>
<td>68.392660</td>
<td>2</td>
<td>256</td>
<td>64</td>
<td>0.025460</td>
<td>0.000803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00033</td>
<td>70.928476</td>
<td>2</td>
<td>256</td>
<td>64</td>
<td>0.016914</td>
<td>0.000214</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00039</td>
<td>71.061583</td>
<td>16</td>
<td>4</td>
<td>64</td>
<td>0.007347</td>
<td>0.000135</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00047</td>
<td>73.694689</td>
<td>4</td>
<td>2</td>
<td>32</td>
<td>0.000104</td>
<td>0.001308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00030</td>
<td>75.212274</td>
<td>16</td>
<td>256</td>
<td>2</td>
<td>0.004354</td>
<td>0.000746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00012</td>
<td>76.112538</td>
<td>128</td>
<td>128</td>
<td>4</td>
<td>0.226784</td>
<td>0.140003</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00005</td>
<td>76.174661</td>
<td>4</td>
<td>4</td>
<td>256</td>
<td>0.086190</td>
<td>0.563438</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00035</td>
<td>76.177571</td>
<td>64</td>
<td>4</td>
<td>128</td>
<td>0.166371</td>
<td>0.330122</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00024</td>
<td>76.185294</td>
<td>32</td>
<td>256</td>
<td>256</td>
<td>0.159865</td>
<td>0.671139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00008</td>
<td>76.193428</td>
<td>256</td>
<td>32</td>
<td>16</td>
<td>0.113514</td>
<td>0.062898</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00014</td>
<td>76.200245</td>
<td>32</td>
<td>128</td>
<td>128</td>
<td>0.561836</td>
<td>0.000226</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00013</td>
<td>76.216345</td>
<td>64</td>
<td>16</td>
<td>64</td>
<td>0.000173</td>
<td>0.194086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00048</td>
<td>76.216390</td>
<td>64</td>
<td>16</td>
<td>64</td>
<td>0.301651</td>
<td>0.000141</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00029</td>
<td>76.216436</td>
<td>16</td>
<td>2</td>
<td>2</td>
<td>0.085926</td>
<td>0.000206</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00038</td>
<td>76.216618</td>
<td>16</td>
<td>256</td>
<td>256</td>
<td>0.005644</td>
<td>0.210313</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00043</td>
<td>76.216619</td>
<td>64</td>
<td>16</td>
<td>64</td>
<td>0.000284</td>
<td>0.433444</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00046</td>
<td>76.216670</td>
<td>256</td>
<td>64</td>
<td>2</td>
<td>0.000617</td>
<td>0.181541</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00036</td>
<td>76.216674</td>
<td>2</td>
<td>64</td>
<td>64</td>
<td>0.680740</td>
<td>0.005030</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00025</td>
<td>76.217288</td>
<td>16</td>
<td>128</td>
<td>16</td>
<td>0.002700</td>
<td>0.051269</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00027</td>
<td>76.218050</td>
<td>2</td>
<td>4</td>
<td>32</td>
<td>0.001925</td>
<td>0.194493</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00006</td>
<td>76.218069</td>
<td>256</td>
<td>2</td>
<td>64</td>
<td>0.003326</td>
<td>0.233648</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00001</td>
<td>76.218267</td>
<td>2</td>
<td>16</td>
<td>256</td>
<td>0.122404</td>
<td>0.001683</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00010</td>
<td>76.219815</td>
<td>128</td>
<td>128</td>
<td>64</td>
<td>0.006478</td>
<td>0.178694</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00017</td>
<td>76.221708</td>
<td>32</td>
<td>32</td>
<td>16</td>
<td>0.004100</td>
<td>0.520138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00044</td>
<td>76.224417</td>
<td>256</td>
<td>2</td>
<td>2</td>
<td>0.019401</td>
<td>0.077370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00002</td>
<td>76.226116</td>
<td>16</td>
<td>2</td>
<td>64</td>
<td>0.000326</td>
<td>0.028026</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00000</td>
<td>76.227517</td>
<td>4</td>
<td>16</td>
<td>128</td>
<td>0.020000</td>
<td>0.307903</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00041</td>
<td>76.268058</td>
<td>256</td>
<td>32</td>
<td>64</td>
<td>0.045152</td>
<td>0.252533</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00032</td>
<td>76.411740</td>
<td>32</td>
<td>32</td>
<td>2</td>
<td>0.541939</td>
<td>0.193151</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00007</td>
<td>76.787387</td>
<td>256</td>
<td>256</td>
<td>2</td>
<td>0.616285</td>
<td>0.114236</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00040</td>
<td>78.233233</td>
<td>64</td>
<td>4</td>
<td>16</td>
<td>0.164726</td>
<td>0.000119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00021</td>
<td>80.997064</td>
<td>128</td>
<td>16</td>
<td>32</td>
<td>0.001292</td>
<td>0.002832</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00016</td>
<td>85.401864</td>
<td>32</td>
<td>16</td>
<td>256</td>
<td>0.055791</td>
<td>0.000965</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f62a3436" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best hyperparameters</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>analysis.get_best_config(metric<span class="op">=</span><span class="st">"loss"</span>, mode<span class="op">=</span><span class="st">"min"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>{'l1': 256,
 'l2': 256,
 'l3': 128,
 'l2_reg': 0.027614886800457164,
 'lr': 0.00012453571993239395}</code></pre>
</div>
</div>
<div id="b702e57c" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the final test on the test set</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>best_config <span class="op">=</span> analysis.get_best_config(metric<span class="op">=</span><span class="st">"loss"</span>, mode<span class="op">=</span><span class="st">"min"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the best hyperparameters to train the model</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Net(best_config[<span class="st">"l1"</span>], best_config[<span class="st">"l2"</span>], best_config[<span class="st">"l3"</span>], best_config[<span class="st">"l2_reg"</span>])</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(net.parameters(), lr<span class="op">=</span>best_config[<span class="st">"lr"</span>])</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):  <span class="co"># loop over the dataset multiple times and store the train, test loss</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_train_torch)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(outputs, y_train_scaled)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add L2 regularization</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">+=</span> net.l2_reg <span class="op">*</span> torch.norm(param)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> net(X_test_torch)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inverse transform the scaled y values to get the original y values</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> scaler.inverse_transform(outputs.numpy())</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred))</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test RMSE: 54.06271747689579
</code></pre>
</div>
</div>
<div id="0735146f" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"y_test"</span>: y_test, <span class="st">"y_pred"</span>: y_pred.reshape(<span class="op">-</span><span class="dv">1</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y_test</th>
<th data-quarto-table-cell-role="th">y_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">246</td>
<td>78.0</td>
<td>107.765800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">425</td>
<td>152.0</td>
<td>110.693916</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">293</td>
<td>200.0</td>
<td>175.535324</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>59.0</td>
<td>82.328522</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>311.0</td>
<td>176.440598</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">117</td>
<td>281.0</td>
<td>246.310699</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">139</td>
<td>281.0</td>
<td>245.451309</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">218</td>
<td>214.0</td>
<td>118.843346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">93</td>
<td>96.0</td>
<td>77.727440</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">420</td>
<td>146.0</td>
<td>134.773529</td>
</tr>
</tbody>
</table>

<p>111 rows × 2 columns</p>
</div>
</div>
</div>
<div id="ba16683b" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thus far it seems even with hyperparameter tuning we are unable to match the performance of ensemble models. </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top 5 configurations</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'loss'</span>, <span class="st">'config/l1'</span>, <span class="st">'config/l2'</span>, <span class="st">'config/l3'</span>, <span class="st">'config/lr'</span>, <span class="st">'config/l2_reg'</span>]].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loss</th>
<th data-quarto-table-cell-role="th">config/l1</th>
<th data-quarto-table-cell-role="th">config/l2</th>
<th data-quarto-table-cell-role="th">config/l3</th>
<th data-quarto-table-cell-role="th">config/lr</th>
<th data-quarto-table-cell-role="th">config/l2_reg</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">trial_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00019</td>
<td>51.555930</td>
<td>256</td>
<td>256</td>
<td>128</td>
<td>0.000125</td>
<td>0.027615</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00015</td>
<td>51.580817</td>
<td>4</td>
<td>64</td>
<td>256</td>
<td>0.003980</td>
<td>0.015450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00003</td>
<td>51.654479</td>
<td>2</td>
<td>64</td>
<td>4</td>
<td>0.000991</td>
<td>0.015054</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c8d42_00037</td>
<td>51.872128</td>
<td>128</td>
<td>32</td>
<td>32</td>
<td>0.000114</td>
<td>0.005181</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c8d42_00031</td>
<td>51.925027</td>
<td>128</td>
<td>64</td>
<td>32</td>
<td>0.000103</td>
<td>0.001919</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="10c9b30c" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>config_list_of_dicts <span class="op">=</span> df[[<span class="st">'config/l1'</span>, <span class="st">'config/l2'</span>, <span class="st">'config/l3'</span>, <span class="st">'config/lr'</span>, <span class="st">'config/l2_reg'</span>]].head(<span class="dv">5</span>).to_dict(<span class="st">'records'</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Train an ensemble of 5 models using the top 5 configurations</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>ensemble <span class="op">=</span> []</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config <span class="kw">in</span> config_list_of_dicts:</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> Net(config[<span class="st">"config/l1"</span>], config[<span class="st">"config/l2"</span>], config[<span class="st">"config/l3"</span>], config[<span class="st">"config/l2_reg"</span>])</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam(net.parameters(), lr<span class="op">=</span>config[<span class="st">"config/lr"</span>])</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>):  <span class="co"># loop over the dataset multiple times and store the train, test loss</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> net(X_train_torch)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, y_train_scaled)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add L2 regularization</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">+=</span> net.l2_reg <span class="op">*</span> torch.norm(param)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    ensemble.append(net)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d5f4d6d7" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the predictions from the ensemble</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>ensemble_preds <span class="op">=</span> []</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> net <span class="kw">in</span> ensemble:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> net(X_test_torch)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Scale the predictions back to the original scale</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> scaler.inverse_transform(outputs.numpy())</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        ensemble_preds.append(outputs)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>ensemble_preds <span class="op">=</span> np.array(ensemble_preds)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the mean of the predictions</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>ensemble_preds_mean <span class="op">=</span> ensemble_preds.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the RMSE of the ensemble</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> criterion(torch.tensor(ensemble_preds_mean), y_test_torch)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test loss: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(loss.item())<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test loss: 83.04458927945727</code></pre>
</div>
</div>
<section id="inputs-to-meta-learning-model" class="level2">
<h2 class="anchored" data-anchor-id="inputs-to-meta-learning-model">Inputs to Meta Learning model</h2>
<section id="data-inputs" class="level3">
<h3 class="anchored" data-anchor-id="data-inputs">Data inputs</h3>
<ol type="1">
<li>Input vector: X is of shape N, D where N is the number of samples and D is the number of features</li>
<li>Output vector: y is of shape N, 1</li>
</ol>
</section>
<section id="encoder-inputs" class="level3">
<h3 class="anchored" data-anchor-id="encoder-inputs">Encoder inputs</h3>
<ol start="3" type="1">
<li>Context vector: Containing C vectors of concatenated (X, y) pairs from the training set. Thus, shape of context vector is (C, D + 1)</li>
</ol>
</section>
</section>
<section id="encoder-internals" class="level2">
<h2 class="anchored" data-anchor-id="encoder-internals">### Encoder internals</h2>
<ol start="4" type="1">
<li>Encoding: Encoder is a neural network that takes in the context vector and outputs a vector of shape (C, E) where E is the encoding size</li>
</ol>
</section>
<section id="encoder-outputs" class="level2">
<h2 class="anchored" data-anchor-id="encoder-outputs">### Encoder outputs</h2>
<ol start="5" type="1">
<li>Encoder summary: A vector of shape (E, ) that is the mean of the encoding</li>
</ol>
</section>
<section id="decoder-inputs" class="level2">
<h2 class="anchored" data-anchor-id="decoder-inputs">### Decoder inputs</h2>
<ol start="6" type="1">
<li>Query vector: Containing Q vectors of X from test set. Thus, shape of query vector is (Q, D)</li>
<li>It also takes the encoder summary as input of size (E, ). But, we make Q copies of the encoder summary and concatenate it with the query vector to get a vector of shape (Q, E + D)</li>
</ol>
</section>
<section id="decoder-outputs" class="level2">
<h2 class="anchored" data-anchor-id="decoder-outputs">### Decoder outputs</h2>
<ol start="8" type="1">
<li>Decoding: Decoder is a neural network that takes in the query vector and encoder summary and outputs a vector of shape (Q, 1)</li>
</ol>
<div id="272a7f29" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> X_train_torch.shape[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4024cd4e" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the encoder </span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Takes as input the number of features, the number of nodes in 3 hidden layers, and the L2 regularization parameter</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Encoder(nn.Module):</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_features <span class="op">=</span> D<span class="op">+</span><span class="dv">1</span>, l1_size<span class="op">=</span><span class="dv">32</span>, l2_size<span class="op">=</span><span class="dv">32</span>, E <span class="op">=</span> <span class="dv">32</span>, l2_reg<span class="op">=</span><span class="fl">0.0</span>):</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Encoder, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l1 <span class="op">=</span> nn.Linear(n_features, l1_size)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2 <span class="op">=</span> nn.Linear(l1_size, l2_size)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l3 <span class="op">=</span> nn.Linear(l2_size, E)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2_reg <span class="op">=</span> l2_reg</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.relu <span class="op">=</span> nn.ReLU()</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l1(x))</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l2(x))</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l3(x))</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5e9b563f" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create C context vectors and pass them through the encoder</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> Encoder(E<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the context vectors input</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>C_idx <span class="op">=</span> np.random.choice(X_train_torch.shape[<span class="dv">0</span>], C, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>C_idx <span class="op">=</span> torch.tensor(C_idx)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Q query vectors</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>all_idx <span class="op">=</span> np.arange(X_train_torch.shape[<span class="dv">0</span>])</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>Q_idx <span class="op">=</span> np.random.choice(np.setdiff1d(all_idx, C_idx), Q, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>Q_idx <span class="op">=</span> torch.tensor(Q_idx)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>C_idx, Q_idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>(tensor([108,  26,  25, 210, 151]), tensor([156, 230]))</code></pre>
</div>
</div>
<div id="aeb57b69" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>X_train_torch[C_idx], y_train_scaled[C_idx], y_train_torch[C_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>(tensor([[-0.0019, -0.0446,  0.0542, -0.0665,  0.0727,  0.0566, -0.0434,  0.0849,
           0.0845,  0.0486],
         [ 0.0817,  0.0507,  0.0013,  0.0356,  0.1264,  0.0911,  0.0192,  0.0343,
           0.0845, -0.0301],
         [ 0.0126, -0.0446,  0.0067, -0.0562, -0.0759, -0.0664, -0.0213, -0.0376,
          -0.0181, -0.0922],
         [ 0.0272, -0.0446,  0.0067,  0.0356,  0.0796,  0.0707,  0.0155,  0.0343,
           0.0407,  0.0113],
         [-0.0709,  0.0507, -0.0752, -0.0401, -0.0511, -0.0151, -0.0397, -0.0026,
          -0.0964, -0.0342]]),
 tensor([[ 0.4966],
         [ 0.5471],
         [ 0.3704],
         [-1.0812],
         [-1.2327]]),
 tensor([192., 196., 182.,  67.,  55.]))</code></pre>
</div>
</div>
<div id="80f78d73" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>context_input <span class="op">=</span> torch.cat((X_train_torch[C_idx], y_train_scaled[C_idx].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(context_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.001882</td>
<td>-0.044642</td>
<td>0.054152</td>
<td>-0.066495</td>
<td>0.072732</td>
<td>0.056619</td>
<td>-0.043401</td>
<td>0.084863</td>
<td>0.084495</td>
<td>0.048628</td>
<td>0.496595</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.081666</td>
<td>0.050680</td>
<td>0.001339</td>
<td>0.035644</td>
<td>0.126395</td>
<td>0.091065</td>
<td>0.019187</td>
<td>0.034309</td>
<td>0.084495</td>
<td>-0.030072</td>
<td>0.547084</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.012648</td>
<td>-0.044642</td>
<td>0.006728</td>
<td>-0.056166</td>
<td>-0.075870</td>
<td>-0.066449</td>
<td>-0.021311</td>
<td>-0.037648</td>
<td>-0.018118</td>
<td>-0.092204</td>
<td>0.370372</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.027178</td>
<td>-0.044642</td>
<td>0.006728</td>
<td>0.035644</td>
<td>0.079612</td>
<td>0.070710</td>
<td>0.015505</td>
<td>0.034309</td>
<td>0.040672</td>
<td>0.011349</td>
<td>-1.081190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.070900</td>
<td>0.050680</td>
<td>-0.075186</td>
<td>-0.040099</td>
<td>-0.051103</td>
<td>-0.015092</td>
<td>-0.039719</td>
<td>-0.002592</td>
<td>-0.096433</td>
<td>-0.034215</td>
<td>-1.232658</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f7cb874e" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>encoder(context_input).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>torch.Size([5, 32])</code></pre>
</div>
</div>
<div id="4ba0fae3" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>encoder(context_input).mean(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>torch.Size([32])</code></pre>
</div>
</div>
<div id="7f66380f" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we will build the decoder</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Decoder(nn.Module):</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, E<span class="op">=</span><span class="dv">32</span>, l1_size<span class="op">=</span><span class="dv">32</span>, l2_size<span class="op">=</span><span class="dv">32</span>, l2_reg<span class="op">=</span><span class="fl">0.0</span>):</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Decoder, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l1 <span class="op">=</span> nn.Linear(E, l1_size)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2 <span class="op">=</span> nn.Linear(l1_size, l2_size)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l3 <span class="op">=</span> nn.Linear(l2_size, <span class="dv">1</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2_reg <span class="op">=</span> l2_reg</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.relu <span class="op">=</span> nn.ReLU()</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l1(x))</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l2(x))</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.l3(x))</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f562bde2" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pass Q query vectors and the context vectors through the decoder</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>decoder <span class="op">=</span> Decoder(E <span class="op">=</span><span class="dv">32</span> <span class="op">+</span> D)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>mean_context <span class="op">=</span> encoder(context_input).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat the mean context vector Q times</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mean_context <span class="op">=</span> mean_context.repeat(Q, <span class="dv">1</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>mean_context.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>torch.Size([2, 32])</code></pre>
</div>
</div>
<div id="802dac26" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> X_train_torch[Q_idx]</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>query.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>torch.Size([2, 10])</code></pre>
</div>
</div>
<div id="c9a60851" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>input_decoder <span class="op">=</span> torch.cat((query, mean_context), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>input_decoder.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>torch.Size([2, 42])</code></pre>
</div>
</div>
<div id="67932400" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>decoder(input_decoder).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>torch.Size([2, 1])</code></pre>
</div>
</div>
<div id="a6469b9c" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a meta learning class</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Meta(nn.Module):</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, D <span class="op">=</span> X_train_torch.shape[<span class="dv">1</span>], E <span class="op">=</span> <span class="dv">32</span>,  C <span class="op">=</span> <span class="dv">10</span>, Q <span class="op">=</span> <span class="dv">2</span>, l1_size<span class="op">=</span><span class="dv">32</span>, l2_size<span class="op">=</span><span class="dv">32</span>, l2_reg<span class="op">=</span><span class="fl">0.0</span>):</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Meta, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.encoder <span class="op">=</span> Encoder(D <span class="op">+</span> <span class="dv">1</span>, l1_size, l2_size, E, l2_reg)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.decoder <span class="op">=</span> Decoder(E <span class="op">+</span> D, l1_size, l2_size, l2_reg)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.D <span class="op">=</span> D</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.E <span class="op">=</span> E</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.C <span class="op">=</span> C</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Q <span class="op">=</span> Q</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l2_reg <span class="op">=</span> l2_reg</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, context_input, query):</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        mean_context <span class="op">=</span> <span class="va">self</span>.encoder(context_input).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Repeat the mean context vector Q times</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>        mean_context <span class="op">=</span> mean_context.repeat(<span class="va">self</span>.Q, <span class="dv">1</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>        input_decoder <span class="op">=</span> torch.cat((query, mean_context), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.decoder(input_decoder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="be1cb370" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> Meta()</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>m(context_input, query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>tensor([[0.],
        [0.]], grad_fn=&lt;ReluBackward0&gt;)</code></pre>
</div>
</div>
<div id="03eee03e" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to get the context and query vectors</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_context_query(X, y, C, Q):</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    C_idx <span class="op">=</span> np.random.choice(X.shape[<span class="dv">0</span>], C, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    C_idx <span class="op">=</span> torch.tensor(C_idx)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    all_idx <span class="op">=</span> np.arange(X.shape[<span class="dv">0</span>])</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    Q_idx <span class="op">=</span> np.random.choice(np.setdiff1d(all_idx, C_idx), Q, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    Q_idx <span class="op">=</span> torch.tensor(Q_idx)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    context_input <span class="op">=</span> torch.cat((X[C_idx], y[C_idx].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> X[Q_idx]</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> context_input, query, y[Q_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bcfad840" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>get_context_query(X_train_torch, y_train_torch, <span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>(tensor([[-6.0003e-02, -4.4642e-02,  1.3387e-03, -2.9771e-02, -7.0728e-03,
          -2.1669e-02,  1.1824e-02, -2.5923e-03,  3.1815e-02, -5.4925e-02,
           2.5800e+02],
         [ 3.0811e-02, -4.4642e-02, -5.0396e-02, -2.2277e-03, -4.4223e-02,
          -8.9935e-02,  1.1859e-01, -7.6395e-02, -1.8118e-02,  3.0644e-03,
           8.7000e+01],
         [ 6.7136e-02, -4.4642e-02,  3.4944e-03,  3.5644e-02,  4.9341e-02,
           3.1254e-02,  7.0730e-02, -3.9493e-02, -6.0925e-04,  1.9633e-02,
           7.3000e+01],
         [ 1.2648e-02, -4.4642e-02,  6.7278e-03, -5.6166e-02, -7.5870e-02,
          -6.6449e-02, -2.1311e-02, -3.7648e-02, -1.8118e-02, -9.2204e-02,
           1.8200e+02],
         [-6.3635e-02,  5.0680e-02, -7.9497e-02, -5.6706e-03, -7.1743e-02,
          -6.6449e-02, -1.0266e-02, -3.9493e-02, -1.8118e-02, -5.4925e-02,
           1.0100e+02],
         [-1.8820e-03, -4.4642e-02, -6.6563e-02,  1.2151e-03, -2.9449e-03,
           3.0702e-03,  1.1824e-02, -2.5923e-03, -2.0289e-02, -2.5930e-02,
           7.9000e+01],
         [-5.6370e-02, -4.4642e-02, -7.4108e-02, -5.0428e-02, -2.4960e-02,
          -4.7034e-02,  9.2820e-02, -7.6395e-02, -6.1177e-02, -4.6641e-02,
           4.8000e+01],
         [-7.0900e-02,  5.0680e-02, -7.5186e-02, -4.0099e-02, -5.1103e-02,
          -1.5092e-02, -3.9719e-02, -2.5923e-03, -9.6433e-02, -3.4215e-02,
           5.5000e+01],
         [ 3.8076e-02,  5.0680e-02, -2.9918e-02, -4.0099e-02, -3.3216e-02,
          -2.4174e-02, -1.0266e-02, -2.5923e-03, -1.2908e-02,  3.0644e-03,
           1.6000e+02],
         [ 3.4443e-02,  5.0680e-02,  1.2529e-01,  2.8758e-02, -5.3855e-02,
          -1.2900e-02, -1.0231e-01,  1.0811e-01,  2.7149e-04,  2.7917e-02,
           3.4100e+02]]),
 tensor([[ 0.0163, -0.0446,  0.0175, -0.0229,  0.0603,  0.0444,  0.0302, -0.0026,
           0.0372, -0.0011],
         [-0.0418, -0.0446,  0.0477,  0.0597,  0.1278,  0.1280, -0.0250,  0.1081,
           0.0639,  0.0403]]),
 tensor([128., 258.]))</code></pre>
</div>
</div>
<div id="96b10654" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Training loop</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>train_loss <span class="op">=</span> []</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>val_losses <span class="op">=</span> []</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>test_losses <span class="op">=</span> []</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>):</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    context_input, query, y_query <span class="op">=</span> get_context_query(X_train_torch, y_train_scaled, <span class="dv">10</span>, <span class="dv">2</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> m(context_input, query)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> criterion(y_pred, y_query)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    train_loss.append(loss.item())</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> - Train loss: </span><span class="sc">{</span>loss<span class="sc">.</span>item()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 0 - Train loss: 0.2789093554019928
Epoch 100 - Train loss: 1.1788500547409058
Epoch 200 - Train loss: 0.6084457039833069
Epoch 300 - Train loss: 0.6604040265083313
Epoch 400 - Train loss: 0.6397659778594971
Epoch 500 - Train loss: 0.18253237009048462
Epoch 600 - Train loss: 0.4401477575302124
Epoch 700 - Train loss: 0.19387057423591614
Epoch 800 - Train loss: 1.3166064023971558
Epoch 900 - Train loss: 0.4808962345123291
Epoch 1000 - Train loss: 0.2843365967273712
Epoch 1100 - Train loss: 0.35177987813949585
Epoch 1200 - Train loss: 1.1539983749389648
Epoch 1300 - Train loss: 2.0983378887176514
Epoch 1400 - Train loss: 3.325526237487793
Epoch 1500 - Train loss: 0.38105207681655884
Epoch 1600 - Train loss: 0.16427072882652283
Epoch 1700 - Train loss: 1.9909170866012573
Epoch 1800 - Train loss: 0.03792643919587135
Epoch 1900 - Train loss: 2.758319854736328</code></pre>
</div>
</div>
<div id="6fa197fe" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="nas_files/figure-html/cell-56-output-1.png" width="540" height="422" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f61f3470" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>context_input, _, _ <span class="op">=</span> get_context_query(X_train_torch, y_train_torch, <span class="dv">10</span>, query.shape[<span class="dv">0</span>])</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>context_input.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>torch.Size([10, 11])</code></pre>
</div>
</div>
<div id="e5d878e8" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>X_test_torch.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>torch.Size([111, 10])</code></pre>
</div>
</div>
<div id="7fac95ee" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>query.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>torch.Size([2, 10])</code></pre>
</div>
</div>
<div id="2d538c55" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>context_input.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>torch.Size([10, 11])</code></pre>
</div>
</div>
<div id="1fe8d270" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use whole of the test set as the query set</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> X_test_torch</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>y_query <span class="op">=</span> y_test_torch</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get context from the training set</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>context_input, _, _ <span class="op">=</span> get_context_query(X_train_torch, y_train_scaled, <span class="dv">10</span>, query.shape[<span class="dv">0</span>])</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> Meta(C<span class="op">=</span><span class="dv">10</span>, Q<span class="op">=</span>query.shape[<span class="dv">0</span>])</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> m(context_input, query)</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use inverse transform to get the original values</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> scaler.inverse_transform(y_pred.detach().numpy())</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test loss: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mean_squared_error(y_query, y_pred))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test loss: 75.22261810302734</code></pre>
</div>
</div>
<div id="69513933" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"y_pred"</span>: y_pred.reshape(<span class="op">-</span><span class="dv">1</span>), <span class="st">"y_query"</span>: y_query})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y_pred</th>
<th data-quarto-table-cell-role="th">y_query</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>169.061569</td>
<td>78.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>168.179596</td>
<td>152.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>168.527161</td>
<td>200.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>168.452423</td>
<td>59.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>168.826492</td>
<td>311.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">106</td>
<td>169.100494</td>
<td>281.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>168.457611</td>
<td>281.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">108</td>
<td>169.019516</td>
<td>214.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">109</td>
<td>168.639725</td>
<td>96.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>169.026901</td>
<td>146.0</td>
</tr>
</tbody>
</table>

<p>111 rows × 2 columns</p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nipunbatra\.github\.io\/blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>